# 一套可长期维护的电商商品（SPU / SKU）与价格体系设计方案

> 适用于：
>
> - 多规格商品
> - 支持整体调价、规格调价、人工干预 SKU
> - 商品新增 & 商品编辑统一页面
> - 不拆分额外“改价接口”，一次提交完成所有修改

---

## 一、设计目标与核心原则

在设计商品系统之前，先明确几个**必须遵守的原则**：

### 1️⃣ 价格是「状态」，不是「公式」

- `salePrice` 是事实
- 不能假设“随时重新算一定一致”
- **最终价格必须落库**

---

### 2️⃣ 规则与人工必须分离

- 自动规则：基础价 + 规格差价
- 人工改价：明确标记、可追溯
- 人工操作 **不能污染规则层**

---

### 3️⃣ 商品编辑是「一次性全量提交」

- 编辑页 ≠ 多个接口拼凑
- 后端以“当前提交内容”为准
- 后端负责统一校验、重算、落库

---

## 二、SPU / SKU 职责划分（核心）

### SPU（Standard Product Unit）

> 描述「这个商品是什么」

- 商品基础信息
- 规格定义
- **定价锚点（basePrice）**

### SKU（Stock Keeping Unit）

> 描述「这个商品具体卖哪一个」

- 规格组合
- 库存
- **最终售价**
- 人工调价状态

---

## 三、basePrice 应该怎么定义？

### ❌ 错误做法

```text
basePrice = 最低 SKU 价格
```

问题：

- 会随着人工改价不断漂移
- 规格差价失效
- 无法回溯定价逻辑

---

### ✅ 正确做法（推荐）

> **basePrice = 官方标准入门配置的价格**

例如：

```text
iPhone 17
颜色：黑色
存储：128GB
```

```json
{
  "basePrice": 5999
}
```

> basePrice 是 **计算起点，不是展示价格**

---

## 四、规格（Spec）设计

### 规格本质

- 规格不存最终价格
- 只存 **价格差（priceDelta）**

### 示例

```json
{
  "specs": [
    {
      "id": "color",
      "name": "颜色",
      "values": [
        { "id": "black", "name": "黑色", "priceDelta": 0 },
        { "id": "red", "name": "红色", "priceDelta": 100 },
        { "id": "white", "name": "白色", "priceDelta": 0 }
      ]
    },
    {
      "id": "storage",
      "name": "存储",
      "values": [
        { "id": "128", "name": "128GB", "priceDelta": 0 },
        { "id": "256", "name": "256GB", "priceDelta": 800 },
        { "id": "512", "name": "512GB", "priceDelta": 1600 },
        { "id": "1tb", "name": "1TB", "priceDelta": 3000 }
      ]
    }
  ]
}
```

---

## 五、SKU 价格模型（重点）

### 推荐字段设计

```json
{
  "salePrice": 7499,
  "manualAdjust": -300
}
```

### 字段语义

| 字段 | 含义 |
| ---- | ---- |
| salePrice | 当前对外销售价（权威） |
| manualAdjust | 人工在自动价基础上的偏移 |

### 核心关系

```text
salePrice = autoPrice + manualAdjust
```

但：

- `autoPrice` 可以运行时计算
- **`salePrice` 必须存库**

---

## 六、为什么要 manualAdjust？

### 典型场景

> 黑色 1TB 手动降价 300 元
> 后来白色规格整体涨价 100 元

如果没有 `manualAdjust`：

- 人工改价会被规则重算覆盖
- 或规则会被永久污染

### 有 manualAdjust 后

```text
新 salePrice = 新 autoPrice + manualAdjust
```

👉 **人工操作永远叠加，不会丢失**

---

## 七、商品新增 / 编辑页面的数据结构（完整）

> 前端只关心一个 JSON
> 后端负责一切校验与计算

---

### 完整提交 JSON 示例

```json
{
  "spu": {
    "id": 1,
    "name": "iPhone 17",
    "basePrice": 5999,
    "status": "ON_SALE"
  },

  "specs": [
    {
      "id": "color",
      "name": "颜色",
      "values": [
        { "id": "black", "name": "黑色", "priceDelta": 0 },
        { "id": "red", "name": "红色", "priceDelta": 100 },
        { "id": "white", "name": "白色", "priceDelta": 0 }
      ]
    },
    {
      "id": "storage",
      "name": "存储",
      "values": [
        { "id": "128", "name": "128GB", "priceDelta": 0 },
        { "id": "256", "name": "256GB", "priceDelta": 800 },
        { "id": "512", "name": "512GB", "priceDelta": 1600 },
        { "id": "1tb", "name": "1TB", "priceDelta": 3000 }
      ]
    }
  ],

  "skus": [
    {
      "id": 1001,
      "specValues": ["black", "128"],
      "salePrice": 5999,
      "manualAdjust": 0,
      "stock": 100
    },
    {
      "id": 1002,
      "specValues": ["black", "1tb"],
      "salePrice": 8699,
      "manualAdjust": -300,
      "stock": 50
    },
    {
      "id": 1003,
      "specValues": ["white", "256"],
      "salePrice": 6899,
      "manualAdjust": 0,
      "stock": 80
    }
  ]
}
```

---

## 八、商品编辑页中的几种操作，影响哪些字段？

### 1️⃣ 整体涨价 / 降价

- 前端批量调整 `salePrice`
- 后端重算 autoPrice
- `manualAdjust` 不变

---

### 2️⃣ 某个规格涨价 / 降价

- 修改 spec.value.priceDelta
- 后端重算所有 SKU autoPrice
- 再叠加 manualAdjust

---

### 3️⃣ 人工干预 SKU

- 只修改 `manualAdjust`
- 同步更新 `salePrice`

---

### 4️⃣ 增加规格

- 新增 spec value
- 后端生成新 SKU
- manualAdjust 默认 0

---

### 5️⃣ 删除规格

- 关联 SKU 标记下架或删除
- 不影响其它 SKU 的价格逻辑

---

## 九、后端落库示例（简化）

### spu 表

```sql
spu (
  id,
  name,
  base_price,
  status
)
```

### spec_value 表

```sql
spec_value (
  id,
  spec_id,
  name,
  price_delta
)
```

### sku 表

```sql
sku (
  id,
  spu_id,
  sale_price,
  manual_adjust,
  stock,
  status
)
```

---

## 十、最重要的一句话总结

> **basePrice 是定价锚点**
> **priceDelta 是规则偏移**
> **manualAdjust 是人工偏移**
> **salePrice 是最终事实**

这套设计可以支持：

- 商品新增 / 编辑
- 任意顺序的调价
- 复杂规格组合
- 长期业务演进而不崩

---
