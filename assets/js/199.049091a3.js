(window.webpackJsonp=window.webpackJsonp||[]).push([[199],{411:function(s,a,e){"use strict";e.r(a);var t=e(6),v=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"本地开发时通过-fiddler-4-调试微信-jssdk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地开发时通过-fiddler-4-调试微信-jssdk"}},[s._v("#")]),s._v(" 本地开发时通过 fiddler 4 调试微信 jssdk")]),s._v(" "),a("p",[s._v("微信 jssdk 要求公众号后台配置 「JS接口安全域名」，并且前端调用 "),a("code",[s._v("wx.config()")]),s._v(" 所在的域名必须与配置的「JS接口安全域名」一致才可以。")]),s._v(" "),a("p",[s._v("但是本地开发时，本地开发服务器的地址通常为 "),a("code",[s._v("localhost:xxxx")]),s._v(", "),a("code",[s._v("127.0.0.1:xxxx")]),s._v(", "),a("code",[s._v("192.168.x.x:xxxx")]),s._v(", "),a("code",[s._v("10.10.x.x:xxxx")]),s._v(", 无法与后台配置的「JS接口安全域名」一致，所以调用 jssdk 时无法成功。")]),s._v(" "),a("p",[s._v("最简单的方法就是使用 fiddler 工具：")]),s._v(" "),a("p",[s._v("此处假设：")]),s._v(" "),a("ul",[a("li",[s._v("电脑和手机在同一局域网内")]),s._v(" "),a("li",[s._v("电脑局域网 ip 为："),a("code",[s._v("192.168.95.1")])]),s._v(" "),a("li",[s._v("项目服务器端口为 "),a("code",[s._v("8080")]),s._v("，也就是项目运行在 "),a("code",[s._v("192.168.95.1:8080")]),s._v(" 上")]),s._v(" "),a("li",[s._v("手机局域网 ip 为 "),a("code",[s._v("192.168.95.100")])]),s._v(" "),a("li",[s._v("公众号配置的「JS接口安全域名」为 "),a("code",[s._v("my.domamin.com")])])]),s._v(" "),a("p",[s._v("在 fiddler 菜单选择 "),a("code",[s._v("Tools")]),s._v(" 下的 "),a("code",[s._v("HOSTS")]),s._v(" 选项：")]),s._v(" "),a("p",[s._v("首先勾选 "),a("code",[s._v("Enable remapping ...")]),s._v(" 表示开启 host 映射，然后在下方的输入框输入以下文本：")]),s._v(" "),a("div",{staticClass:"language-text line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("192.168.95.1:8080 my.domamin.com\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("以上示例表示：当我访问 "),a("code",[s._v("my.domamin.com")]),s._v(" 时，fiddler 工具会将请求映射到 "),a("code",[s._v("192.168.95.1:8080")]),s._v(" 上去。这样实现的效果就是，在浏览器客户端中打开的地址是 "),a("code",[s._v("my.domamin.com")]),s._v(" ，和发布到线上的访问地址是一样的，但实际上，访问的内容是我们本地开发服务器 "),a("code",[s._v("192.168.95.1:8080")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"设置微信开发者工具的代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置微信开发者工具的代理"}},[s._v("#")]),s._v(" 设置微信开发者工具的代理")]),s._v(" "),a("p",[s._v("如果在微信开发者工具上进行网页调试时，访问 "),a("code",[s._v("my.domamin.com")]),s._v(" 没有被映射到 "),a("code",[s._v("192.168.95.1:8080")]),s._v(" 去，检查一下设置中的代理设置，设置为使用「系统代理」即可。")]),s._v(" "),a("h2",{attrs:{id:"设置手机网络使用-fiddler-软件的服务器作代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置手机网络使用-fiddler-软件的服务器作代理"}},[s._v("#")]),s._v(" 设置手机网络使用 fiddler 软件的服务器作代理")]),s._v(" "),a("p",[s._v("fiddler 软件启动时，默认会启动一个服务器，监听端口为 "),a("code",[s._v("8888")]),s._v("，完整就是 "),a("code",[s._v("192.168.95.1:8888")]),s._v("。")]),s._v(" "),a("p",[s._v("找到手机已连接的和电脑属于同一局域网的 WIFI，进入这个 WIFI 设置手动代理，然后 "),a("code",[s._v("Hostname")]),s._v("(服务器) 一栏输入 "),a("code",[s._v("192.168.95.1")]),s._v(", "),a("code",[s._v("Port")]),s._v("(端口) 一栏输入 "),a("code",[s._v("8888")]),s._v(", 然后保存即可。")]),s._v(" "),a("h2",{attrs:{id:"项目配置更改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#项目配置更改"}},[s._v("#")]),s._v(" 项目配置更改")]),s._v(" "),a("p",[s._v("如果访问时，出现 "),a("code",[s._v("Invalid Host header")]),s._v("，那是因为开发模式下使用的 webpack-dev-server 校验域名不通过，有多种方式解决：")]),s._v(" "),a("ul",[a("li",[s._v("将域名校验禁用即可， "),a("code",[s._v("disableHostCheck: true")])]),s._v(" "),a("li",[s._v("将自己使用的域名 "),a("code",[s._v("my.domamin.com")]),s._v(" 添加允许访问本地服务器的域名列表中去，"),a("code",[s._v("allowedHosts: ['my.domamin.com']")])])]),s._v(" "),a("p",[s._v("webpack 4 中，两者都可以使用，webpack 5 中，废弃了 "),a("code",[s._v("disableHostCheck")]),s._v(" 配置，只能使用 "),a("code",[s._v("allowedHosts")]),s._v(" 。")]),s._v(" "),a("p",[s._v("第一种：禁用域名检查")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("devServer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("disableHostCheck")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("第二种：配置域名白名单(推荐此方式)")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("devServer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置为字符串 'all' 将允许所有域名，相当于设置了 disableHostCheck: true")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// allowedHosts: 'all',")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 设置为 'auto' 将允许 localhost, host 配置项的值，client.webSocketURL.hostname 配置项的值")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// allowedHosts: 'auto',")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("allowedHosts")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'localhost'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'my.domamin.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])])])}),[],!1,null,null,null);a.default=v.exports}}]);