(window.webpackJsonp=window.webpackJsonp||[]).push([[190],{395:function(s,a,t){"use strict";t.r(a);var e=t(6),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"存储过程-存储函数-游标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储过程-存储函数-游标"}},[s._v("#")]),s._v(" 存储过程_存储函数_游标")]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#存储过程-procedure"}},[s._v("存储过程 PROCEDURE")]),a("ul",[a("li",[a("a",{attrs:{href:"#创建存储过程-create-procedure"}},[s._v("创建存储过程 CREATE PROCEDURE")]),a("ul",[a("li",[a("a",{attrs:{href:"#带参数的存储过程"}},[s._v("带参数的存储过程")])]),a("li",[a("a",{attrs:{href:"#存储过程特性"}},[s._v("存储过程特性")])])])]),a("li",[a("a",{attrs:{href:"#显示创建一个存储过程的语句"}},[s._v("显示创建一个存储过程的语句")])]),a("li",[a("a",{attrs:{href:"#删除存储过程"}},[s._v("删除存储过程")])])])]),a("li",[a("a",{attrs:{href:"#存储函数"}},[s._v("存储函数")]),a("ul",[a("li",[a("a",{attrs:{href:"#创建存储函数-create-function"}},[s._v("创建存储函数 CREATE FUNCTION")])])])]),a("li",[a("a",{attrs:{href:"#游标-cursor"}},[s._v("游标 cursor")]),a("ul",[a("li",[a("a",{attrs:{href:"#使用游标"}},[s._v("使用游标")])])])])])]),a("p"),s._v(" "),a("p",[s._v("存储程序可以分为存储过程和函数。在 MySQL 中，创建存储过程和函数使用的语句分别是 "),a("code",[s._v("CREATE PROCEDURE")]),s._v(" 和 "),a("code",[s._v("CREATE FUNCTION")]),s._v(" ，使用 "),a("code",[s._v("CALL")]),s._v(" 语句来调用存储过程，只能用输出变量返回值。函数可以从语句外调用(引用函数名)，也能返回标量值。存储过程也可以调用其他存储过程。")]),s._v(" "),a("h2",{attrs:{id:"存储过程-procedure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储过程-procedure"}},[s._v("#")]),s._v(" 存储过程 PROCEDURE")]),s._v(" "),a("p",[s._v("什么是存储过程，简单来说，就是为以后的使用而保存的一条或多条 MySQL 语句的集合。可将其视为批处理文件，虽然它们的作用不仅限于批处理。")]),s._v(" "),a("p",[s._v("使用存储过程的好处：")]),s._v(" "),a("ul",[a("li",[s._v("拆分复杂的操作，封装成更小的单元，简化操作。")]),s._v(" "),a("li",[s._v("团队成员复用，保持一致的团队操作，降低出错。")]),s._v(" "),a("li",[s._v("解耦，如果表名，列名或业务逻辑变化，只需要修改封装好的存储过程即可，不用修改业务代码。")]),s._v(" "),a("li",[s._v("提高性能。因为使用存储过程比使用单独的SQL语句要快。")]),s._v(" "),a("li",[s._v("一些只能用在单个请求中的 MySQL 元素和特性，存储过程可以使用它们来编写功能更强更灵活的代码。")])]),s._v(" "),a("p",[s._v("存储过程的好处总结：简单、安全、高性能。")]),s._v(" "),a("p",[s._v("一般来说，存储过程的编写比基本 SQL 语句复杂，编写存储过程需要更高的技能，更丰富的经验。")]),s._v(" "),a("p",[s._v("你可能没有创建存储过程的安全访问权限。许多数据库管理员限制存储过程的创建权限，只允许用户使用存储过程，但不允许他们创建存储过程。")]),s._v(" "),a("h3",{attrs:{id:"创建存储过程-create-procedure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建存储过程-create-procedure"}},[s._v("#")]),s._v(" 创建存储过程 "),a("code",[s._v("CREATE PROCEDURE")])]),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存储过程其实也是一种函数，所以名称后有一对圆括号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果存储过程接受参数，它们将在 () 中列举出来。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("存储过程名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("参数列表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("存储过程特性"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("封装的语句"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个存储过程，用于获得用户表中所有用户的平均年龄")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" avg_user_age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("AVG")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" avg_age "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("上例中，"),a("code",[s._v("CREATE PROCEDURE avg_user_age()")]),s._v(" 创建一个名为 "),a("code",[s._v("avg_user_age")]),s._v(" 且不需要参数的存储过程， "),a("code",[s._v("BEGIN")]),s._v(" 和 "),a("code",[s._v("END")]),s._v(" 语句用来限定存储过程体，指示开始和结束。")]),s._v(" "),a("p",[s._v("上例中，"),a("code",[s._v("BEGIN")]),s._v(" 和 "),a("code",[s._v("END")]),s._v(" 中间的语句结束使用了分号 "),a("code",[s._v(";")]),s._v(" ，创建存储过程的整个语句末尾也有分号 "),a("code",[s._v(";")]),s._v(" ，这在命令行程序中使用时会出现句法错误，解决办法是临时更改命令行实用程序的语句分隔符。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" avg_user_age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Avg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" avg_age "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("开头的 "),a("code",[s._v("DELIMITER //")]),s._v(" 表示临时指定语句分隔符为 "),a("code",[s._v("//")]),s._v(" ， 所以创建语句的末尾使用了 "),a("code",[s._v("END //")]),s._v(" 作为语句结束分隔符。最后 "),a("code",[s._v("DELIMITER ;")]),s._v(" 将分隔符恢复成分号。")]),s._v(" "),a("p",[s._v("除了 "),a("code",[s._v("\\")]),s._v(" 符号外，其他的字符都可以用来指定为临时分隔符。")]),s._v(" "),a("p",[s._v("调用存储过程使用 "),a("code",[s._v("CALL")]),s._v(" 关键字：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CALL")]),s._v(" avg_user_age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"带参数的存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#带参数的存储过程"}},[s._v("#")]),s._v(" 带参数的存储过程")]),s._v(" "),a("p",[s._v("创建带参数的存储过程，每个参数都有三部分组成，分别是 "),a("code",[s._v("<参数类型> <参数名称> <参数数据类型>")]),s._v(" 。")]),s._v(" "),a("p",[s._v("参数类型取值为以下之一：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("IN")]),s._v(" 接收参数")]),s._v(" "),a("li",[a("code",[s._v("OUT")]),s._v(" 输出参数")]),s._v(" "),a("li",[a("code",[s._v("INOUT")]),s._v(" 即可接收参数，也可输出参数")])]),s._v(" "),a("p",[s._v("参数名任意定义，参数数据类型就是 MySQL 支持的数据类型。")]),s._v(" "),a("p",[s._v("语法：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("存储过程名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("参数类型"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("参数名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("参数数据类型"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("参数类型"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("参数名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("参数数据类型"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("参数类型"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("参数名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("参数数据类型"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("封装的语句"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("在 "),a("code",[s._v("BEGIN <封装的语句> END")]),s._v(" 封装的语句中，通过 "),a("code",[s._v("INTO")]),s._v(" 关键字将值传给 "),a("code",[s._v("OUT")]),s._v(" 类型的参数，比如 "),a("code",[s._v("SELECT <列名> INTO <参数名称> ...")])]),s._v(" "),a("p",[s._v("示例：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个存储过程，可获取用户表中最大年龄，最小年龄，平均年龄")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" user_age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUT")]),s._v(" maxa "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUT")]),s._v(" mina "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUT")]),s._v(" avga "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INT")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("Max")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" maxa "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("min")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" mina "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("avg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" avga "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" users"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("上例中，创建了一个存储过程叫做 "),a("code",[s._v("user_age")]),s._v(" , 它接收三个参数，分别是 "),a("code",[s._v("maxa")]),s._v(", "),a("code",[s._v("mina")]),s._v(", "),a("code",[s._v("avga")]),s._v(", 每个参数必须具有指定的类型。")]),s._v(" "),a("p",[s._v("关键字 "),a("code",[s._v("OUT")]),s._v(" 指出相应的参数用来从存储过程传出一个值（返回给调用者）。")]),s._v(" "),a("p",[s._v("封装的语句中，通过 INTO 关键字将查询出的值赋值给了 "),a("code",[s._v("maxa")]),s._v(", "),a("code",[s._v("mina")]),s._v(", "),a("code",[s._v("avga")]),s._v(" 这三个参数。")]),s._v(" "),a("p",[s._v("调用带参数的存储过程：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有 MySQL 变量命名都必须以 @ 开始")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 变量名不需要和存储过程的参数名相同，但顺序和数量必须一致。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CALL")]),s._v(" user_age"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@max_age")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@min_age")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@avg_age")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("在调用语句执行之后，这条语句并不显示任何数据。它仅仅返回了这三个变量，可以在之后使用这三个变量。")]),s._v(" "),a("p",[s._v("访问 "),a("strong",[s._v("调用存储过程返回的变量")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 直接访问变量，这条语句查询出三列，分别是这三个变量，以及他们的值")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@max_age")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@min_age")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@avg_age")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"存储过程特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储过程特性"}},[s._v("#")]),s._v(" 存储过程特性")]),s._v(" "),a("p",[s._v("存储过程特性有以下取值：")]),s._v(" "),a("ul",[a("li",[s._v("LANGUAGE SQL: 说明routine_ _body 部分是由SQL语句组成的，当前系统支持的语言为\nSQL。SQL是LANGUAGE特性的唯一值。")]),s._v(" "),a("li",[s._v("[NOT] DETERMINISTIC: 指明存储过程执行的结果是否正确。DETERMINISTIC表示结.\n果是确定的。每次执行存储过程时,相同的输入会得到相同的输出。NOT DETERMINISTIC\n表示结果是不确定的，相同的输入可能得到不同的输出。如果没有指定任意一个值，默认\n为NOT DETERMINISTIC.")]),s._v(" "),a("li",[s._v("{ CONTAINS SQL | NO SQL| READS SQL DATA | MODIFIES SQL DATA}:指明子程序使\n用SQL语句的限制。CONTAINS SQL表明子程序包含SQL语句，但是不包含读写数据的\n语句; NOSQL表明子程序不包含SQL语句; READS SQL DATA说明子程序包含读数据\n的语句; MODIFIES SQL DATA表明子程序包含写数据的语句。默认情况下，系统会指定\n为CONTAINS SQL。")]),s._v(" "),a("li",[s._v("SQL SECURITY { DEFINER |INVOKER }:指明谁有权限来执行。DEFINER 表示只有定\n义者才能执行。INVOKER 表示拥有权限的调用者可以执行。默认情况下，系统指定为\nDEFINER。")]),s._v(" "),a("li",[s._v("COMMENT 'string': 注释信息，可以用来描述存储过程或函数。")])]),s._v(" "),a("h3",{attrs:{id:"显示创建一个存储过程的语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#显示创建一个存储过程的语句"}},[s._v("#")]),s._v(" 显示创建一个存储过程的语句")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看创建存储过程的语句")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("存储过程名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看何时、由谁创建等详细信息，列出所有存储过程")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为限制其输出，可使用 LIKE 指定一个过滤模式")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("STATUS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("LIKE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<过滤模式>'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"删除存储过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除存储过程"}},[s._v("#")]),s._v(" 删除存储过程")]),s._v(" "),a("p",[s._v("存储过程在创建之后，被保存在服务器上以供使用，直至被删除。")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果指定的过程不存在，将产生一个错误")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("存储过程名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 判断当指定的存储过程存在时，才将它删除")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DROP")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXISTS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("存储过程名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"存储函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储函数"}},[s._v("#")]),s._v(" 存储函数")]),s._v(" "),a("h3",{attrs:{id:"创建存储函数-create-function"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建存储函数-create-function"}},[s._v("#")]),s._v(" 创建存储函数 "),a("code",[s._v("CREATE FUNCTION")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FUNCTION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("函数名"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("参数列表"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RETURNS")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("数据类型"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RETURN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("封装的语句"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ul",[a("li",[a("code",[s._v("CREATE FUNCTION <函数名>([参数列表])")]),s._v(" 创建函数")]),s._v(" "),a("li",[s._v("参数列表格式为 "),a("code",[s._v("IN <参数> <数据类型>")]),s._v(" ，不同于存储过程，参数类型只有 "),a("code",[s._v("IN")]),s._v(" 接收参数类型")]),s._v(" "),a("li",[a("code",[s._v("RETURNS <数据类型>")]),s._v(" 指定函数返回的数据类型，返回值不符合时，将会被强制改为恰当的返回值的类型。")]),s._v(" "),a("li",[a("code",[s._v("RETURN (<封装的语句>)")]),s._v(" 返回实际的结果")])]),s._v(" "),a("h2",{attrs:{id:"游标-cursor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#游标-cursor"}},[s._v("#")]),s._v(" 游标 cursor")]),s._v(" "),a("p",[s._v("有时，需要在检索出来的行中前进或后退一行或多行。这就是使用游标的原因。游标（cursor）是一个存储在MySQL服务器上的数据库查询，它不是一条 SELECT 语句，而是被该语句检索出来的结果集。在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。")]),s._v(" "),a("p",[s._v("游标主要用于交互式应用，其中用户需要滚动屏幕上的数据，并对数据进行浏览或做出更改。")]),s._v(" "),a("p",[s._v("不像多数 DBMS，MySQL 游标只能用于存储过程（和函数）。")]),s._v(" "),a("h3",{attrs:{id:"使用游标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用游标"}},[s._v("#")]),s._v(" 使用游标")]),s._v(" "),a("p",[s._v("游标用 DECLARE 语句创建：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PROCEDURE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("存储过程名称"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("游标名"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CURSOR")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FOR")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("查询语句"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("END")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("创建游标后，使用 "),a("code",[s._v("OPEN <游标名>")]),s._v(" 打开游标：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在处理 OPEN 语句时执行查询，存储检索出的数据以供浏览和滚动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPEN")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("游标名"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("游标处理完成后，应当使用如下语句关闭游标：")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CLOSE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("游标名"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("CLOSE 释放游标使用的所有内部内存和资源，因此在每个游标不再需要时都应该关闭。")]),s._v(" "),a("p",[s._v("在一个游标关闭后，如果没有重新打开，则不能使用它。")]),s._v(" "),a("p",[s._v("如果你不明确关闭游标，MySQL将会在到达 END 语句时自动关闭它。")]),s._v(" "),a("p",[s._v("待完善...")])])}),[],!1,null,null,null);a.default=n.exports}}]);